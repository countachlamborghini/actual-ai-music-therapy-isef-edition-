<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="AI Music Therapy">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ai_music_therapy">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ai_music_therapy</title>
  <base href="/actual-ai-music-therapy-isef-edition-/">
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.js" id="faceapi-script"></script>
  <link rel="icon" type="image/png" href="favicon.png"/>
  <link rel="manifest" href="manifest.json">
  <style>
    /* Force Flutter elements to occupy full page to avoid zero-sized glass pane */
    flutter-view, flt-glass-pane, #flutterweb-theme, [flutter-view] {
      position: fixed !important;
      inset: 0 !important;
      width: 100% !important;
      height: 100% !important;
      display: block !important;
      z-index: 0 !important;
    }
  </style>
</head>
<body>
  <!-- Deployment build banner: visible if this exact HTML is loaded -->
  <div id="deployed-version" style="position:fixed;top:10px;left:10px;padding:6px 10px;background:#0b74de;color:white;border-radius:6px;font-weight:600;z-index:9999">Build: 202601021740</div>
  <video id="emotion-video" autoplay muted playsinline style="display: none;"></video>
  <script>console.log('DEPLOY BUILD: 202601021740');</script>
  <script>
    window.addEventListener('error', function (e) {
      console.error('Runtime error captured:', e.message || e);
      const banner = document.getElementById('deployed-version');
      if (banner) banner.innerText = 'Build: 202601021740 — ERROR: ' + (e.message || 'see console');
      const detail = document.getElementById('deploy-error-detail');
      if (detail) detail.textContent = 'Runtime error: ' + (e.message || e);
      document.body.style.backgroundColor = '#fff8f8';
    });
    window.addEventListener('unhandledrejection', function (e) {
      console.error('Unhandled rejection:', e.reason || e);
      const banner = document.getElementById('deployed-version');
      if (banner) banner.innerText = 'Build: 202601021740 — UNHANDLED REJECTION';
      const detail = document.getElementById('deploy-error-detail');
      if (detail) detail.textContent = 'Unhandled rejection: ' + (e.reason && (e.reason.message || e.reason) || e);
      document.body.style.backgroundColor = '#fff8f8';
    });
  </script>
  <script src="main.dart.js" type="application/javascript" onload="console.log('main.dart.js loaded')" onerror="console.error('main.dart.js failed to load')"></script>
  <script>
    // Post-load runtime checks for Flutter
    setTimeout(() => {
      try {
        console.log('flutterConfiguration present:', !!window.flutterConfiguration);
        console.log('flutterCanvasKit present:', !!window.flutterCanvasKit);
        const views = document.querySelectorAll('flutter-view, flt-glass-pane, #flutterweb-theme, [flutter-view]');
        console.log('flutter view-like elements count:', views.length, views);

        // Highlight each suspected Flutter element and report its size/style
        views.forEach((el, i) => {
          try {
            const r = el.getBoundingClientRect();
            console.log(`Flutter element[${i}] tag:${el.tagName} id:${el.id || ''} class:${el.className} rect: ${r.width}x${r.height} @ (${r.left},${r.top})`);
            const cs = getComputedStyle(el);
            console.log(`Flutter element[${i}] computed style: display=${cs.display} position=${cs.position} width=${cs.width} height=${cs.height} visibility=${cs.visibility}`);
            const highlight = document.createElement('div');
            highlight.style.position = 'fixed';
            highlight.style.left = `${r.left}px`;
            highlight.style.top = `${r.top}px`;
            highlight.style.width = `${Math.max(2, r.width)}px`;
            highlight.style.height = `${Math.max(2, r.height)}px`;
            highlight.style.border = '3px dashed rgba(0,200,100,0.9)';
            highlight.style.zIndex = '999999';
            highlight.style.pointerEvents = 'none';
            highlight.title = `Flutter element ${i}`;
            document.body.appendChild(highlight);

            const info = document.createElement('div');
            info.style.position = 'fixed';
            info.style.left = `${Math.max(2, r.left)}px`;
            info.style.top = `${Math.max(2, r.top - 22)}px`;
            info.style.background = 'rgba(0,200,100,0.9)';
            info.style.color = '#fff';
            info.style.padding = '2px 6px';
            info.style.fontSize = '12px';
            info.style.zIndex = '1000000';
            info.textContent = `${el.tagName} ${Math.round(r.width)}x${Math.round(r.height)}`;
            document.body.appendChild(info);
          } catch (e) {
            console.warn('Failed to highlight element', e);
          }
        });

        // Also look for canvas elements and report
        const canvases = document.querySelectorAll('canvas');
        canvases.forEach((c, i) => {
          const r = c.getBoundingClientRect();
          console.log(`Canvas[${i}] size: ${r.width}x${r.height} display:${getComputedStyle(c).display}`);
        });
      } catch (e) {
        console.error('Runtime diagnostic failed:', e);
      }
    }, 1200);
  </script>
  <div id="deploy-error-detail" style="position:fixed;bottom:10px;left:10px;right:10px;padding:10px;background:#fff1f1;border-left:4px solid #ff4d4f;color:#222;display:block;z-index:9998"></div>
</body>
</html>